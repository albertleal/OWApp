<!DOCTYPE html>
<html>
<head manifest="manifest.mf">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="apple-mobile-web-app-capable" content="yes">

	<title>My Sample WebApp</title>
	<!--Default Theme CSS files -->
	<link href="themes/default/bootstrap-3.0.2/css/bootstrap.min.css" rel="stylesheet">
	<link href="themes/default/css/bootstrapOverride.css" rel="stylesheet">
	<link href="themes/default/css/default.css" rel="stylesheet">
	<link href="themes/default/css/animations.css" rel="stylesheet">
	<!-- Load any future theme wieth the App init function-->
</head>
<body>
	<div id="container">
		<div id="leftLayer" class="canvas off-canvas-left">
			<div class="canvas-content">
				<ul id="menu" class="canvas scrollable">
					<li class="menu-element" onclick="javascript:loadViewFromMenu('first-view')">
						<div class="icon"></div>
						<div class="content">Home</div>
					</li>
					<li class="menu-element">
						<div class="icon"></div>
						<div class="content">test 2</div>
					</li>

				</ul>
			</div>
		</div>
		<div id="centerLayer" class="canvas in-canvas">
			<div id="header" class="canvas-content">
				<div id="displayLeftPanel">&nbsp;</div>
				<center>
					<div id="title">operation title</div>
				</center>
			</div>
			<div class="alert alert-dismissable"><button type="button" class="close" aria-hidden="true">&times;</button><span id="alertText"></span></div>
			<div class="scrollable" id="operationContent">
				<div class="oldPage"></div>
				<div class="currentPage"></div>
				<div class="newPage"></div>
			</div>
			<div id="footer">hola footer</div>
		</div>
		<div id="rightLayer" class="canvas off-canvas-right">
			<div class="canvas-content">
				RIGHT
				<a href="javascript:toogleOffCanvasRight();">toogleOffCanvasRight</a>
			</div>
		</div>
	</div>
	<!--Libs and dependencies-->
	<script type="text/javascript" src="js/lib/cordova/cordova-3.0.3.js"></script>
	<script data-main="js/require-config" src="js/lib/require/require-2.1.9.min.js"></script>
	<script type="text/javascript" charset="utf-8" src="js/lib/head/head-load-1.0.1.min.js"></script>
	<script type="text/javascript" charset="utf-8" src="js/lib/jquery/jquery-2.0.3.min.js"></script>
	<!--script type="text/javascript" charset="utf-8" src="js/lib/jquery/plugins/jquery.touch-1.3.2.js"></script-->
	<script src="themes/default/bootstrap-3.0.2/js/bootstrap.min.js"></script>
	<script type="text/javascript" charset="utf-8" src="js/lib/hammer/hammer.js"></script>
	<script type="text/javascript" charset="utf-8" src="js/lib/hammer/jquery.hammer.js"></script>
	<script type="text/javascript">
		function showLeftMenu(){
			if($('.in-canvas').hasClass('in-canvas-left-active')){
				$('#operationContent').removeClass('no-touch');
				$('#footer').removeClass('no-touch');
				
				$('#operationContent').addClass('scrollable');
				$('#menu').removeClass("scrollable");

				$('.in-canvas').addClass('pushLeftContentForMenu');
				$('.off-canvas-left').addClass('pushLeftMenu');	
				$('#displayLeftPanel').removeClass('ui-state-active');	
				setTimeout(function(){
					$('.in-canvas').removeClass('in-canvas-left-active');
					$('.off-canvas-left').removeClass('off-canvas-left-active');
					$('.in-canvas').removeClass('pushLeftContentForMenu');
					$('.off-canvas-left').removeClass('pushLeftMenu');
				},300);
			}else{
				$('#menu').scrollTop(0);
				$('#operationContent').addClass('no-touch');
				$('#footer').addClass('no-touch');
				
				$('#operationContent').removeClass('scrollable');
				$('#menu').addClass("scrollable");

				$('.in-canvas').addClass('pushRightContentForMenu');
				$('.off-canvas-left').addClass('pushRightMenu');
				$('#displayLeftPanel').addClass('ui-state-active');
				setTimeout(function(){
					$('.in-canvas').removeClass('pushRightContentForMenu');
					$('.off-canvas-left').removeClass('pushRightMenu');
					$('.in-canvas').addClass('in-canvas-left-active');
					$('.off-canvas-left').addClass('off-canvas-left-active');
				},300);
			}
		}
		document.addEventListener('deviceready', onDeviceReady, false);
		function onDeviceReady(){
			alert('device ready');
		}
		$(document).ready(function() {
			alert('document ready');
			//No scrollable webapp
			window.ontouchmove = function(e) {e.preventDefault()};
			//Force scroll on scrollable class
			$('.scrollable').on('touchmove', function(e){
				//alert('scroll');
				e.stopPropagation();
			});
			$( window ).resize(function() {
				resizeInterface();
			});
			window.addEventListener("orientationchange", function() {
				resizeInterface();
			}, false);
			resizeInterface();
			$('#displayLeftPanel').on('click',function(){
				showLeftMenu();
			});
			$('#title').on('click',function(){
				if(!$('#operationContent').hasClass('no-touch')){
					$('#operationContent').animate({
					  scrollTop: 0
					}, 300);
				}
			});
			$('#header').on('click',function(){
				if($('#operationContent').hasClass('no-touch')){
					showLeftMenu();
				}
			});
			$('body').hammer().on('swipe', function(event){ //capture swipe event
				if ( $('#leftLayer').hasClass('off-canvas-left-active') ) { //active menu
					if (event.gesture.direction == 'left') { //swipe left
						//alert('LEFT!');
						showLeftMenu();
					}					
				}else{
					var tanto = ($('#centerLayer').width()*30)/100; //30% container width(left menu size)
					if (event.gesture.startEvent.center.pageX < tanto) { //did gesture start in
						if (event.gesture.direction == 'right') { //swipe right
							//alert('RIGHT!');
							showLeftMenu();
						}
					}else{ //out of menu zone
						//alert('TOO FAR FROM MENU!');
					}
				}
			});
			$('#operationContent').scroll(function() {
  				$('.alert').hide();
			});
			$('button.close').on('click', function(e){
				e.preventDefault();
				$('.alert').hide();
			});
			//fake navigation 
			loadView('first-view',null,'currentPage');
		});

		function resizeInterface(){
			var windowWidth = $( window ).width();
			var windowHeight = $( window ).height();
			var headerHeight = $('#header').height();	
			var footerHeight = $('#footer').is(":visible") ? $('#footer').height() : 0;		

			if(windowWidth > 320){
				$('body').removeClass("mobile");
				$('body').addClass("tablet");
			}else{
				$('body').removeClass("tablet");
				$('body').addClass("mobile");
			}
			$('.canvas').height(windowHeight);
			$('#menu').height(windowHeight-parseInt($('.canvas-content').css('padding-top').replace('px','')));
			$('#operationContent').height(windowHeight-headerHeight-footerHeight);
		};
		var navigationStack=[];
		function loadViewFromMenu(view){
			loadView(view,null,"currentPage");
			showLeftMenu();
		}
		function loadView(view, fromView,container){
			if(view == null){
				view = navigationStack[navigationStack.length -2];
			}
			$.ajax({
			  url: "./views/"+view+".html",
			  cache: false
			}).done(function( html ) {
				console.log(container);
				//$('#operationContent').html('');
				switch(container){
					case 'oldPage':
						navigationStack.pop(fromView);
						$('.oldPage').append( html );
						$('.currentPage').addClass('movePageLeft');
						$('.currentPage').remove();
						$('.oldPage').addClass('currentPage').removeClass('oldPage');
						$('.currentPage').after('<div class="oldPage"></div>');
						break;
					case 'currentPage':
						navigationStack.push(view);
						$('.currentPage').html('');
						$('.currentPage').append( html );
						break;
					case 'newPage':
						navigationStack.push(view);
						$('.newPage').append( html );
						$('.currentPage').addClass('movePageRight');
						$('.currentPage').remove();
						$('.newPage').addClass('currentPage').removeClass('newPage');
						$('.currentPage').after('<div class="newPage"></div>');
						break;
				}


			}).fail(function() {
    			$('#alertText').html('Error cargando la p√°gina');
    			$('.alert').addClass('alert-danger');
    			$('.alert').show();
  			});
  			console.log(navigationStack);
		}
	</script>
	<!-- /container
		moreVIews = blackBoxLayer ModalLayer PopOverLayer
	-->
</body>
</html>